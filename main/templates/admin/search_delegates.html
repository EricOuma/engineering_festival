<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <title>SLS ADMIN</title>
  </head>
  <body>
    <h3 class="mt-3 text-center">MPESA CODE APPROVAL</h3>

    <div class="container mt-4">
    
            {# icon and search-box #}
            <div class="text-center">
                <input class="form-control mr-sm-2" id="user-input" type="search" placeholder="Search Delegate Name" aria-label="Search">
            </div>
        
            {# delegate-list section #}
            <div id="replaceable-content" class="mt-3">
                {% include 'delegates-results-partial.html' %}
            </div>
    </div>
    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
        const user_input = $("#user-input")
        const delegates_div = $('#replaceable-content')
        const endpoint = '/admin/main/delegate/search_delegates/'
        const delay_by_in_ms = 700
        let scheduled_function = false
    
        let ajax_call = function (endpoint, request_parameters) {
            $.getJSON(endpoint, request_parameters)
                .done(response => {
                    // fade out the delegates_div, then:
                    delegates_div.fadeTo('slow', 0).promise().then(() => {
                        // replace the HTML contents
                        delegates_div.html(response['html_from_view'])
                        // fade-in the div with new contents
                        delegates_div.fadeTo('slow', 1)
                    })
                })
        }
    
    
        user_input.on('keyup', function () {
    
            const request_parameters = {
                q:$(this).val() // value of user_input: the HTML element with ID user-input
            }
    
            // if scheduled_function is NOT false, cancel the execution of the function
            if (scheduled_function) {
                clearTimeout(scheduled_function)
            }
    
            // setTimeout returns the ID of the function to be executed
            scheduled_function = setTimeout(ajax_call, delay_by_in_ms, endpoint, request_parameters)
        })
    </script>
  </body>
</html>